# Copyright (c) 2022-2023, NVIDIA CORPORATION. All rights reserved.
#
# Permission is hereby granted, free of charge, to any person obtaining a
# copy of this software and associated documentation files (the "Software"),
# to deal in the Software without restriction, including without limitation
# the rights to use, copy, modify, merge, publish, distribute, sublicense,
# and/or sell copies of the Software, and to permit persons to whom the
# Software is furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in
# all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
# DEALINGS IN THE SOFTWARE.

require holoscan-common.conf

TEGRA_DGPU = "1"

# Display Drivers
IMAGE_INSTALL:append = " nvidia-driver"

# The nvidia-uvm module is normally loaded on first use, but this may cause RDMA
# tests to fail the first time they're run so we load them at boot time instead.
KERNEL_MODULE_AUTOLOAD:append = " nvidia-uvm"

PREFERRED_VERSION_xserver-xorg-video-nvidia = "530.30.02"
PREFERRED_RPROVIDER_kernel-module-nvidia = "nvidia-open-gpu-kernel-modules"
PREFERRED_RPROVIDER_kernel-module-nvidia-drm = "nvidia-open-gpu-kernel-modules"
PREFERRED_RPROVIDER_kernel-module-nvidia-modeset = "nvidia-open-gpu-kernel-modules"
PREFERRED_RPROVIDER_tegra-libraries-cuda = "libnvidia-compute"
PREFERRED_RPROVIDER_tegra-libraries-eglcore = "libnvidia-gl"
PREFERRED_RPROVIDER_tegra-libraries-glescore = "libnvidia-gl"
PREFERRED_RPROVIDER_tegra-libraries-glxcore = "libnvidia-gl"
PREFERRED_RPROVIDER_tegra-libraries-vulkan = "libnvidia-gl"
PREFERRED_RPROVIDER_egl-gbm = "libnvidia-gl"

# CUDA
PREFERRED_VERSION_cuda-cccl = "11.8.89-1"
PREFERRED_VERSION_cuda-command-line-tools = "11.8.0-1"
PREFERRED_VERSION_cuda-compiler = "11.8.0-1"
PREFERRED_VERSION_cuda-cudart = "11.8.89-1"
PREFERRED_VERSION_cuda-cuobjdump = "11.8.86-1"
PREFERRED_VERSION_cuda-cupti = "11.8.87-1"
PREFERRED_VERSION_cuda-cuxxfilt = "11.8.86-1"
PREFERRED_VERSION_cuda-driver = "11.8.89-1"
PREFERRED_VERSION_cuda-gdb = "11.8.86-1"
PREFERRED_VERSION_cuda-libraries = "11.8.0-1"
PREFERRED_VERSION_cuda-nvcc = "11.8.89-1"
PREFERRED_VERSION_cuda-nvcc-headers = "11.8.89-1"
PREFERRED_VERSION_cuda-nvdisasm = "11.8.86-1"
PREFERRED_VERSION_cuda-nvml = "11.8.86-1"
PREFERRED_VERSION_cuda-nvprune = "11.8.86-1"
PREFERRED_VERSION_cuda-nvrtc = "11.8.89-1"
PREFERRED_VERSION_cuda-nvtx = "11.8.86-1"
PREFERRED_VERSION_cuda-profiler-api = "11.8.86-1"
PREFERRED_VERSION_cuda-sanitizer = "11.8.86-1"
PREFERRED_VERSION_cuda-toolkit = "11.8.0-1"
PREFERRED_VERSION_libcublas = "11.11.3.6-1"
PREFERRED_VERSION_libcufft = "10.9.0.58-1"
PREFERRED_VERSION_libcurand = "10.3.0.86-1"
PREFERRED_VERSION_libcusolver = "11.4.1.48-1"
PREFERRED_VERSION_libcusparse = "11.7.5.86-1"
PREFERRED_VERSION_libnpp = "11.8.0.86-1"
PREFERRED_VERSION_cuda-cccl-native = "11.8.89-1"
PREFERRED_VERSION_cuda-command-line-tools-native = "11.8.0-1"
PREFERRED_VERSION_cuda-compiler-native = "11.8.0-1"
PREFERRED_VERSION_cuda-cudart-native = "11.8.89-1"
PREFERRED_VERSION_cuda-cuobjdump-native = "11.8.86-1"
PREFERRED_VERSION_cuda-cupti-native = "11.8.87-1"
PREFERRED_VERSION_cuda-cuxxfilt-native = "11.8.86-1"
PREFERRED_VERSION_cuda-driver-native = "11.8.89-1"
PREFERRED_VERSION_cuda-gdb-native = "11.8.86-1"
PREFERRED_VERSION_cuda-libraries-native = "11.8.0-1"
PREFERRED_VERSION_cuda-nvcc-native = "11.8.89-1"
PREFERRED_VERSION_cuda-nvcc-headers-native = "11.8.89-1"
PREFERRED_VERSION_cuda-nvdisasm-native = "11.8.86-1"
PREFERRED_VERSION_cuda-nvml-native = "11.8.86-1"
PREFERRED_VERSION_cuda-nvprune-native = "11.8.86-1"
PREFERRED_VERSION_cuda-nvrtc-native = "11.8.89-1"
PREFERRED_VERSION_cuda-nvtx-native = "11.8.86-1"
PREFERRED_VERSION_cuda-profiler-api-native = "11.8.86-1"
PREFERRED_VERSION_cuda-sanitizer-native = "11.8.86-1"
PREFERRED_VERSION_cuda-toolkit-native = "11.8.0-1"
PREFERRED_VERSION_libcublas-native = "11.11.3.6-1"
PREFERRED_VERSION_libcufft-native = "10.9.0.58-1"
PREFERRED_VERSION_libcurand-native = "10.3.0.86-1"
PREFERRED_VERSION_libcusolver-native = "11.4.1.48-1"
PREFERRED_VERSION_libcusparse-native = "11.7.5.86-1"
PREFERRED_VERSION_libnpp-native = "11.8.0.86-1"

# CUDA Samples
PREFERRED_VERSION_cuda-samples = "11.8"

# cuDNN
PREFERRED_VERSION_cudnn = "8.7.0.84"

# TensorRT
PREFERRED_VERSION_tensorrt = "8.5.3.1"
PREFERRED_VERSION_tensorrt-samples = "8.5.3.1"
PREFERRED_PROVIDER_tensorrt-core = "tensorrt"
PREFERRED_PROVIDER_tensorrt-plugins = "tensorrt"
PREFERRED_PROVIDER_tensorrt-trtexec = "tensorrt"

# Nsight Systems
PREFERRED_VERSION_nsight-systems-cli = "2023.1.1.127-1"
PREFERRED_VERSION_nsight-systems-ui = "2023.1.1.127-1"

# Override the CUDA version (11.8) and GPU arch to:
#    8.6 (Ampere) for the RTX A6000 (default).
#    7.5 (Turing) for the RTX 6000 (Clara AGX Devkit).
CUDA_VERSION = "11.8"
TEGRA_CUDA_ARCHITECTURE = "86"
TEGRA_CUDA_ARCHITECTURE:clara-agx-xavier-devkit = "75"
