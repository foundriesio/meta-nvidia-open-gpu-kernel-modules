# Copyright (c) 2022, NVIDIA CORPORATION. All rights reserved.
#
# Permission is hereby granted, free of charge, to any person obtaining a
# copy of this software and associated documentation files (the "Software"),
# to deal in the Software without restriction, including without limitation
# the rights to use, copy, modify, merge, publish, distribute, sublicense,
# and/or sell copies of the Software, and to permit persons to whom the
# Software is furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in
# all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
# DEALINGS IN THE SOFTWARE.

require holoscan-common.conf

TEGRA_DGPU = "1"

# Display Drivers
IMAGE_INSTALL:append = " \
    nvidia-open-gpu-kernel-modules \
    nvidia-dgpu-drivers \
"

PREFERRED_RPROVIDER_kernel-module-nvidia = "nvidia-open-gpu-kernel-modules"
PREFERRED_RPROVIDER_kernel-module-nvidia-drm = "nvidia-open-gpu-kernel-modules"
PREFERRED_RPROVIDER_kernel-module-nvidia-modeset = "nvidia-open-gpu-kernel-modules"
PREFERRED_RPROVIDER_tegra-libraries-cuda = "nvidia-dgpu-drivers"
PREFERRED_RPROVIDER_tegra-libraries-eglcore = "nvidia-dgpu-drivers"
PREFERRED_RPROVIDER_tegra-libraries-glescore = "nvidia-dgpu-drivers"
PREFERRED_RPROVIDER_tegra-libraries-glxcore = "nvidia-dgpu-drivers"
PREFERRED_RPROVIDER_tegra-libraries-vulkan = "nvidia-dgpu-drivers"

XSERVER = "xserver-xorg xf86-input-evdev nvidia-dgpu-drivers xserver-xorg-module-libwfb"

# CUDA
PREFERRED_VERSION_cuda-cccl = "11.7.91-1"
PREFERRED_VERSION_cuda-command-line-tools = "11.7.1-1"
PREFERRED_VERSION_cuda-compiler = "11.7.1-1"
PREFERRED_VERSION_cuda-cudart = "11.7.99-1"
PREFERRED_VERSION_cuda-cuobjdump = "11.7.91-1"
PREFERRED_VERSION_cuda-cupti = "11.7.101-1"
PREFERRED_VERSION_cuda-cuxxfilt = "11.7.91-1"
PREFERRED_VERSION_cuda-driver = "11.7.99-1"
PREFERRED_VERSION_cuda-gdb = "11.7.91-1"
PREFERRED_VERSION_cuda-libraries = "11.7.1-1"
PREFERRED_VERSION_cuda-nvcc = "11.7.99-1"
PREFERRED_VERSION_cuda-nvcc-headers = "11.7.99-1"
PREFERRED_VERSION_cuda-nvdisasm = "11.7.91-1"
PREFERRED_VERSION_cuda-nvml = "11.7.91-1"
PREFERRED_VERSION_cuda-nvprof = "11.7.101-1"
PREFERRED_VERSION_cuda-nvprune = "11.7.91-1"
PREFERRED_VERSION_cuda-nvrtc = "11.7.99-1"
PREFERRED_VERSION_cuda-nvtx = "11.7.91-1"
PREFERRED_VERSION_cuda-profiler-api = "11.7.101-1"
PREFERRED_VERSION_cuda-sanitizer = "11.7.91-1"
PREFERRED_VERSION_cuda-toolkit = "11.7.1-1"
PREFERRED_VERSION_libcublas = "11.10.3.66-1"
PREFERRED_VERSION_libcufft = "10.7.2.91-1"
PREFERRED_VERSION_libcurand = "10.2.10.91-1"
PREFERRED_VERSION_libcusolver = "11.4.0.1-1"
PREFERRED_VERSION_libcusparse = "11.7.4.91-1"
PREFERRED_VERSION_libnpp = "11.7.4.75-1"
PREFERRED_VERSION_cuda-cccl-native = "11.7.91-1"
PREFERRED_VERSION_cuda-command-line-tools-native = "11.7.1-1"
PREFERRED_VERSION_cuda-compiler-native = "11.7.1-1"
PREFERRED_VERSION_cuda-cudart-native = "11.7.99-1"
PREFERRED_VERSION_cuda-cuobjdump-native = "11.7.91-1"
PREFERRED_VERSION_cuda-cupti-native = "11.7.101-1"
PREFERRED_VERSION_cuda-cuxxfilt-native = "11.7.91-1"
PREFERRED_VERSION_cuda-driver-native = "11.7.99-1"
PREFERRED_VERSION_cuda-gdb-native = "11.7.91-1"
PREFERRED_VERSION_cuda-libraries-native = "11.7.1-1"
PREFERRED_VERSION_cuda-nvcc-native = "11.7.99-1"
PREFERRED_VERSION_cuda-nvcc-headers-native = "11.7.99-1"
PREFERRED_VERSION_cuda-nvdisasm-native = "11.7.91-1"
PREFERRED_VERSION_cuda-nvml-native = "11.7.91-1"
PREFERRED_VERSION_cuda-nvprof-native = "11.7.101-1"
PREFERRED_VERSION_cuda-nvprune-native = "11.7.91-1"
PREFERRED_VERSION_cuda-nvrtc-native = "11.7.99-1"
PREFERRED_VERSION_cuda-nvtx-native = "11.7.91-1"
PREFERRED_VERSION_cuda-profiler-api-native = "11.7.101-1"
PREFERRED_VERSION_cuda-sanitizer-native = "11.7.91-1"
PREFERRED_VERSION_cuda-toolkit-native = "11.7.1-1"
PREFERRED_VERSION_libcublas-native = "11.10.3.66-1"
PREFERRED_VERSION_libcufft-native = "10.7.2.91-1"
PREFERRED_VERSION_libcurand-native = "10.2.10.91-1"
PREFERRED_VERSION_libcusolver-native = "11.4.0.1-1"
PREFERRED_VERSION_libcusparse-native = "11.7.4.91-1"
PREFERRED_VERSION_libnpp-native = "11.7.4.75-1"

# CUDA Samples
PREFERRED_VERSION_cuda-samples = "11.6"

# cuDNN
PREFERRED_VERSION_cudnn = "8.5.0.96"

# TensorRT
PREFERRED_VERSION_tensorrt-samples = "8.4.3.1"
PREFERRED_PROVIDER_tensorrt-core = "tensorrt"
PREFERRED_PROVIDER_tensorrt-plugins = "tensorrt"
PREFERRED_PROVIDER_tensorrt-trtexec = "tensorrt"

# Override the CUDA version (11.7) and GPU arch to:
#    7.5 (Turing) for the RTX 6000 in the Clara AGX Devkit.
#    8.6 (Ampere) for the RTX A6000 in the Holoscan Devkit.
CUDA_VERSION = "11.7"
TEGRA_CUDA_ARCHITECTURE:clara-agx-xavier-devkit ?= "75"
TEGRA_CUDA_ARCHITECTURE:holoscan-devkit ?= "86"
